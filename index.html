<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- GitHub Pagesのサブディレクトリに対応 -->
    <base href="/boywithdv-portfolio/">
    <title>boywithdv | Senior Flutter Engineer</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Babel: .tsxのMIMEタイプ問題を回避するために使用 -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        :root { --bg: #02040a; --indigo: #6366f1; }
        body { 
            background-color: var(--bg); 
            color: #f8fafc; 
            margin: 0; 
            overflow-x: hidden; 
            font-family: 'Inter', sans-serif;
        }
        canvas {
            position: fixed !important;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -1;
            pointer-events: none;
        }
        #loading-screen {
            position: fixed;
            inset: 0;
            background: #02040a;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.8s ease;
        }
        .spinner {
            width: 40px;
            height: 40px;
            border: 2px solid rgba(99, 102, 241, 0.1);
            border-top: 2px solid var(--indigo);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .glass {
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.03);
        }
        .text-gradient {
            background: linear-gradient(to right, #818cf8, #c084fc, #22d3ee);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    </style>

    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.0.0",
    "react-dom": "https://esm.sh/react-dom@19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
    "three": "https://esm.sh/three@0.170.0",
    "@google/genai": "https://esm.sh/@google/genai@1.34.0",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body>
    <div id="loading-screen">
        <div class="spinner"></div>
        <p id="loading-text" style="margin-top: 1.5rem; font-family: 'JetBrains Mono', monospace; font-size: 10px; color: #475569; letter-spacing: 0.3em; text-transform: uppercase;">Initializing Kernel...</p>
    </div>
    
    <div id="root"></div>

    <!-- コンテンツ表示失敗時のバックアップ案内 -->
    <script>
        setTimeout(() => {
            const root = document.getElementById('root');
            if (root && root.innerHTML === "") {
                const text = document.getElementById('loading-text');
                if (text) {
                    text.innerHTML = "BOOT_ERROR: Failed to mount React. Check console for MIME issues.";
                    text.style.color = "#ef4444";
                }
            }
        }, 8000);
    </script>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import ReactDOM from 'react-dom/client';
        import * as THREE from 'three';
        import { GoogleGenAI } from "@google/genai";

        // --- Shader (Interative Raymarching) ---
        const fragmentShader = `
            precision highp float;
            uniform float uTime;
            uniform vec2 uResolution;
            uniform vec2 uMouse;
            uniform float uPulse;

            float smin(float a, float b, float k) {
                float h = max(k - abs(a - b), 0.0) / k;
                return min(a, b) - h * h * k * 0.25;
            }

            float map(vec3 p) {
                float d = 1000.0;
                // Base floating orbs
                for(int i=0; i<5; i++) {
                    float t = uTime * 0.3 + float(i) * 1.8;
                    vec3 pos = vec3(sin(t)*1.5, cos(t*0.7)*1.0, sin(t*0.4)*0.5);
                    float orb = length(p - pos) - (0.4 + sin(float(i))*0.1);
                    d = smin(d, orb, 0.7);
                }
                // Interactive mouse/touch orb
                vec3 mousePos = vec3((uMouse - 0.5) * vec2(5.0, 3.0), 0.0);
                float mouseOrb = length(p - mousePos) - (0.2 + uPulse * 0.6);
                d = smin(d, mouseOrb, 0.8);
                return d;
            }

            void main() {
                vec2 uv = (gl_FragCoord.xy * 2.0 - uResolution.xy) / min(uResolution.x, uResolution.y);
                vec3 ro = vec3(0.0, 0.0, 4.0);
                vec3 rd = normalize(vec3(uv, -1.8));
                float t = 0.0;
                for(int i=0; i<45; i++) {
                    float d = map(ro + rd * t);
                    if(d < 0.001 || t > 10.0) break;
                    t += d;
                }
                vec3 col = vec3(0.01, 0.01, 0.02);
                if(t < 10.0) {
                    vec3 p = ro + rd * t;
                    vec2 e = vec2(0.01, 0.0);
                    vec3 n = normalize(vec3(map(p+e.xyy)-map(p-e.xyy), map(p+e.yxy)-map(p-e.yxy), map(p+e.yyx)-map(p-e.yyx)));
                    float diff = max(dot(n, normalize(vec3(1,2,3))), 0.0);
                    float fresnel = pow(1.0 + dot(rd, n), 4.0);
                    col = vec3(0.05, 0.07, 0.15) + diff * 0.1 + fresnel * vec3(0.2, 0.3, 0.6) * (1.0 + uPulse * 3.0);
                }
                col *= 1.0 - length(uv) * 0.4;
                gl_FragColor = vec4(col, 1.0);
            }
        `;

        const FluidBackground = () => {
            const containerRef = useRef();
            const pulseRef = useRef(0);
            const mouseRef = useRef(new THREE.Vector2(0.5, 0.5));

            useEffect(() => {
                const scene = new THREE.Scene();
                const camera = new THREE.OrthographicCamera(-1, 1, 1, -1, 0, 1);
                const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                containerRef.current.appendChild(renderer.domElement);

                const material = new THREE.ShaderMaterial({
                    uniforms: {
                        uTime: { value: 0 },
                        uResolution: { value: new THREE.Vector2(window.innerWidth, window.innerHeight) },
                        uMouse: { value: mouseRef.current },
                        uPulse: { value: 0 }
                    },
                    fragmentShader
                });

                const mesh = new THREE.Mesh(new THREE.PlaneGeometry(2, 2), material);
                scene.add(mesh);

                const animate = () => {
                    material.uniforms.uTime.value += 0.015;
                    pulseRef.current *= 0.94;
                    material.uniforms.uPulse.value = pulseRef.current;
                    material.uniforms.uMouse.value.copy(mouseRef.current);
                    renderer.render(scene, camera);
                    requestAnimationFrame(animate);
                };
                animate();

                const onMove = (e) => {
                    const x = e.touches ? e.touches[0].clientX : e.clientX;
                    const y = e.touches ? e.touches[0].clientY : e.clientY;
                    mouseRef.current.set(x / window.innerWidth, 1 - y / window.innerHeight);
                };
                const onClick = () => { pulseRef.current = 1.0; };

                window.addEventListener('mousemove', onMove);
                window.addEventListener('touchmove', onMove);
                window.addEventListener('mousedown', onClick);
                window.addEventListener('touchstart', onClick);
                window.addEventListener('resize', () => {
                    renderer.setSize(window.innerWidth, window.innerHeight);
                    material.uniforms.uResolution.value.set(window.innerWidth, window.innerHeight);
                });

                return () => renderer.dispose();
            }, []);

            return <div ref={containerRef} className="fixed inset-0 -z-10" />;
        };

        const App = () => {
            const [scrolled, setScrolled] = useState(false);
            const [input, setInput] = useState('');
            const [messages, setMessages] = useState([
                { role: 'assistant', text: "➜ boywithdv_core: active. Tap anywhere to pulse the abyssal field. How can I assist your development today?" }
            ]);
            const [loading, setLoading] = useState(false);

            useEffect(() => {
                const h = () => setScrolled(window.scrollY > 40);
                window.addEventListener('scroll', h);
                const loader = document.getElementById('loading-screen');
                if (loader) {
                    setTimeout(() => {
                        loader.style.opacity = '0';
                        setTimeout(() => loader.remove(), 800);
                    }, 1000);
                }
                return () => window.removeEventListener('scroll', h);
            }, []);

            const onChat = async (e) => {
                e.preventDefault();
                if (!input.trim() || loading) return;
                const userMsg = { role: 'user', text: input };
                setMessages(prev => [...prev, userMsg]);
                setInput('');
                setLoading(true);

                try {
                    const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
                    const response = await ai.models.generateContent({
                        model: 'gemini-3-pro-preview',
                        contents: `User asks: ${input}`,
                        config: {
                            systemInstruction: "You are the AI representative for 'boywithdv'. High-end, technical, concise. Use markdown. Citations required.",
                            tools: [{ googleSearch: {} }]
                        }
                    });
                    setMessages(prev => [...prev, { role: 'assistant', text: response.text, sources: response.candidates[0].groundingMetadata?.groundingChunks }]);
                } catch (err) {
                    setMessages(prev => [...prev, { role: 'assistant', text: "➜ ERROR: Neural bridge failed. Connection unstable." }]);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="min-h-screen">
                    <FluidBackground />
                    
                    <nav className={`fixed top-0 w-full z-50 transition-all duration-500 ${scrolled ? 'bg-black/80 backdrop-blur-xl py-4 border-b border-white/5' : 'bg-transparent py-8'}`}>
                        <div className="max-w-7xl mx-auto px-6 flex justify-between items-center">
                            <div className="flex items-center gap-3 font-black text-xl tracking-tighter">
                                <div className="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center text-sm shadow-lg shadow-indigo-600/40">B</div>
                                <span className="hidden sm:block">boywithdv</span>
                            </div>
                            <div className="flex gap-8 text-[10px] font-mono tracking-[0.3em] uppercase opacity-50">
                                <a href="#work" className="hover:text-indigo-400 transition-colors">Portfolio</a>
                                <a href="#terminal" className="hover:text-indigo-400 transition-colors">Terminal</a>
                                <a href="https://github.com/boywithdv" target="_blank" className="hover:text-indigo-400 transition-colors">GitHub</a>
                            </div>
                        </div>
                    </nav>

                    <header className="min-h-screen flex flex-col justify-center px-6 md:px-20 max-w-7xl mx-auto">
                        <p className="text-indigo-500 font-mono text-[10px] tracking-[0.6em] uppercase mb-8 opacity-60">Clean Architecture // Mobile Specialist</p>
                        <h1 className="text-6xl md:text-[9rem] font-black leading-[0.85] tracking-tighter mb-12">
                            Flutter<br/>
                            <span className="text-gradient">Abyssal.</span>
                        </h1>
                        <p className="text-slate-500 text-lg md:text-2xl max-w-2xl leading-relaxed font-light mb-16">
                            Building hyper-performant, cross-platform experiences with <span className="text-white">Dart</span> precision and high-end aesthetic.
                        </p>
                        <div className="flex gap-4">
                            <a href="#work" className="px-10 py-5 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-2xl transition-all shadow-2xl shadow-indigo-600/30">View Systems</a>
                        </div>
                    </header>

                    <section id="work" className="py-40 px-6 md:px-20 max-w-7xl mx-auto border-t border-white/5">
                        <div className="mb-24">
                            <h2 className="text-[10px] font-mono text-indigo-500 uppercase tracking-[0.5em] mb-4">01 // SELECTED_WORKS</h2>
                            <h3 className="text-5xl font-bold tracking-tight">Recent Deployments</h3>
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                            {[
                                {t: "Core Flutter Suite", d: "Enterprise-grade architectural templates.", i: "layer-group"},
                                {t: "UI Fluid Kit", d: "Advanced shaders and painters for Dart.", i: "paint-brush"},
                                {t: "CI/CD Automata", d: "Mobile delivery pipeline optimizations.", i: "cogs"}
                            ].map((p, i) => (
                                <div key={i} className="glass p-10 rounded-[2.5rem] hover:scale-[1.02] transition-all duration-500 group">
                                    <div className="w-14 h-14 bg-indigo-500/10 rounded-2xl flex items-center justify-center text-indigo-400 mb-8 group-hover:bg-indigo-500 group-hover:text-white transition-all">
                                        <i className={`fas fa-${p.i} text-xl`} />
                                    </div>
                                    <h4 className="text-2xl font-bold mb-4">{p.t}</h4>
                                    <p className="text-slate-500 text-sm leading-relaxed mb-8">{p.d}</p>
                                    <div className="flex gap-2">
                                        <span className="text-[9px] font-mono px-3 py-1 bg-white/5 rounded-full text-slate-500 border border-white/5 uppercase">active</span>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </section>

                    <section id="terminal" className="py-40 px-6 md:px-20 bg-black/40 border-y border-white/5">
                        <div className="max-w-4xl mx-auto">
                            <div className="text-center mb-20">
                                <h2 className="text-[10px] font-mono text-indigo-500 uppercase tracking-[0.5em] mb-4">02 // INTELLIGENCE</h2>
                                <h3 className="text-5xl font-bold tracking-tight">AI Terminal Core</h3>
                            </div>
                            <div className="glass w-full rounded-3xl overflow-hidden shadow-3xl h-[600px] flex flex-col font-mono text-sm">
                                <div className="px-6 py-4 bg-white/5 border-b border-white/5 flex justify-between items-center">
                                    <div className="flex gap-2.5"><div className="w-3 h-3 rounded-full bg-red-500/30" /><div className="w-3 h-3 rounded-full bg-yellow-500/30" /><div className="w-3 h-3 rounded-full bg-green-500/30" /></div>
                                    <span className="opacity-30 tracking-widest uppercase text-[10px]">kernel_v3.0.1</span>
                                </div>
                                <div className="flex-grow p-10 overflow-y-auto space-y-8">
                                    {messages.map((m, i) => (
                                        <div key={i} className={`flex flex-col ${m.role === 'user' ? 'items-end' : 'items-start'}`}>
                                            <span className={`text-[9px] font-bold mb-2 opacity-40 uppercase tracking-widest ${m.role === 'user' ? 'text-indigo-400' : 'text-cyan-400'}`}>
                                                {m.role === 'user' ? 'guest@terminal' : 'system@boywithdv'}
                                            </span>
                                            <div className={`max-w-[90%] leading-relaxed ${m.role === 'user' ? 'text-slate-400' : 'text-slate-200'}`}>
                                                {m.text}
                                            </div>
                                            {m.sources && (
                                                <div className="mt-6 flex flex-wrap gap-2 opacity-50">
                                                    {m.sources.map((s, si) => s.web && (
                                                        <a key={si} href={s.web.uri} target="_blank" className="text-[8px] px-2 py-1 bg-white/5 rounded border border-white/5 hover:bg-indigo-500/20 transition-colors">[{s.web.title}]</a>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                    {loading && <div className="text-indigo-500 animate-pulse">_ CALCULATING_RESPONSE...</div>}
                                </div>
                                <form onSubmit={onChat} className="p-8 border-t border-white/5 bg-white/[0.02] flex gap-4">
                                    <span className="text-indigo-500">$</span>
                                    <input 
                                        className="bg-transparent border-none focus:ring-0 w-full text-slate-300 placeholder:opacity-20" 
                                        value={input} 
                                        onChange={e => setInput(e.target.value)} 
                                        placeholder="Enter technical query..."
                                    />
                                </form>
                            </div>
                        </div>
                    </section>

                    <footer className="py-24 text-center border-t border-white/5 bg-black/80">
                        <div className="flex justify-center gap-10 text-slate-600 mb-10 text-xl">
                            <a href="https://github.com/boywithdv" target="_blank" className="hover:text-white transition-all hover:scale-125"><i className="fab fa-github" /></a>
                            <a href="mailto:hello@boywithdv.me" className="hover:text-white transition-all hover:scale-125"><i className="fas fa-envelope" /></a>
                        </div>
                        <p className="text-slate-700 font-mono text-[10px] tracking-[0.6em] uppercase">© 2024 BOYWITHDV • ALL SYSTEMS NOMINAL</p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>